<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth'
            });
            calendar.render();
        });

    </script>
    <title>Horario</title>


</head>
<body>

    <div style="max-width: 1000px; margin: auto" id='calendar'></div>
    <script>
        let request_calendar;

        $.ajax({

            url: '/Horario/GetTrainingSchedules',

            type: 'GET',

            dataType: 'json',

            success: function (response) {

                request_calendar = response;

                console.log("Datos cargados correctamente", request_calendar);

                initCalendar(); // <--- Llama a la función initCalendar cuando la solicitud AJAX se completa

            },

            error: function (error) {

                console.log("Error al cargar los datos");

            }

        });


        function initCalendar() {

            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {

                initialView: 'dayGridMonth',

                events: function (info, successCallback, failureCallback) {

                    let events = request_calendar.map(function (Horario) {

                        return {

                            title: Horario.Grupos,

                            start: new Date(Horario.Fecha),

                            timeStart: Horario.HoraInicio,

                            timeEnd: Horario.HoraFin

                        }

                    });

                    successCallback(events);

                }

            });

            calendar.render();

        }


        document.addEventListener('DOMContentLoaded', function () {

            // No necesitas hacer nada aquí, la función initCalendar se llama cuando la solicitud AJAX se completa

        });
    </script>
</body>
</html>